# Cloudflare Pages Configuration for BrainSAIT Identity IOD

name = "brainsait-identity-iod"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[env.production]
name = "brainsait-identity-iod-production"
compatibility_date = "2024-01-01"

[[env.production.vars]]
ENVIRONMENT = "production"

[[env.production.vars]]
APP_NAME = "BrainSAIT Identity IOD"

[[env.production.vars]]
APP_VERSION = "1.0.0"

# Pages configuration
pages_build_output_dir = "dist"

# Cloudflare D1 Database
[[d1_databases]]
binding = "DB"
database_name = "brainsait-identity-db"
database_id = "5e268327-3dd4-439c-bd1f-5deca25d1c01"

# Cloudflare KV Namespaces
[[kv_namespaces]]
binding = "SESSIONS"
id = "7b6626f2032d4be1ba7a0b4e6f21b4a0"

[[kv_namespaces]]
binding = "CACHE"
id = "31e992ccf15f46778a1e0b974aea62ba"

[[kv_namespaces]]
binding = "NEURAL_CONTEXT"
id = "0e9465383ad44d519cd3994b33641f41"

# Cloudflare R2 Buckets
[[r2_buckets]]
binding = "DOCUMENTS"
bucket_name = "brainsait-identity-documents"

[[r2_buckets]]
binding = "NEURAL_DATA"
bucket_name = "brainsait-neural-data"

# Build configuration
[build]
command = "npm run build"
cwd = "."
watch_dir = "src"

# Routing configuration
[[redirects]]
from = "/api/*"
to = "/api/:splat"
status = 200

[[redirects]]
from = "/*"
to = "/index.html"
status = 200

# Security headers
[[headers]]
for = "/*"
[headers.values]
X-Frame-Options = "DENY"
X-Content-Type-Options = "nosniff"
X-XSS-Protection = "1; mode=block"
Referrer-Policy = "strict-origin-when-cross-origin"
Permissions-Policy = "camera=(), microphone=(), geolocation=()"
Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"

[[headers]]
for = "/assets/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "*.js"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "*.css"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

# Environment variables (will be set via Cloudflare dashboard)
[vars]
NODE_ENV = "production"
BRAINSAIT_OID_ROOT = "1.3.6.1.4.1.61026"